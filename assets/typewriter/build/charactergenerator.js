// Generated by CoffeeScript 1.6.3
(function() {
  var characterGenerator, random;

  random = require('./random');

  characterGenerator = function(keyboardLayout, accuracy, checkInterval, text) {
    var currentIndex, shouldCorrect, typoIndex;
    currentIndex = -1;
    typoIndex = -1;
    shouldCorrect = false;
    return {
      next: function() {
        var result;
        if (currentIndex >= text.length - 1) {
          if (typoIndex !== -1) {
            shouldCorrect = true;
          } else {
            return null;
          }
        }
        if (!shouldCorrect) {
          currentIndex++;
          shouldCorrect = typoIndex !== -1 && currentIndex % checkInterval === 0;
          if (random.integerInRange(0, 100) > accuracy) {
            result = keyboardLayout.getAdjacentCharacter(text.charAt(currentIndex));
            if (result == null) {
              return text.charAt(currentIndex);
            }
            if (typoIndex === -1) {
              typoIndex = currentIndex;
              shouldCorrect = random.integerInRange(0, 1) === 1;
            }
            return result;
          } else {
            return text.charAt(currentIndex);
          }
        }
        if (currentIndex >= typoIndex) {
          currentIndex--;
          return '\b';
        }
        shouldCorrect = false;
        typoIndex = -1;
        return text.charAt(++currentIndex);
      }
    };
  };

  module.exports = characterGenerator;

}).call(this);
